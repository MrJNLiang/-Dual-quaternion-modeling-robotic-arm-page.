## 项目需求总结（最终一致版本）

### 1) 项目目标与形式
- 做一个**交互式 Web 单页应用**（可不离线），用 **对偶四元数（Dual Quaternion）qt 形式**对机械臂进行建模与可视化教学。
- 面向“数学转控制”的学习：要求做到 **公式 ↔ UI ↔ 3D** 严格对应，每个关键公式都能在 UI 中看到、代入、交互。

### 2) 机械臂建模要求（结构与几何）
- 机械臂为**串联机构**，最终版本是 **4-DOF：3R + 1P**  
  - Joint1：R（默认绕 z）  
  - Joint2：R（默认绕 y）  
  - Joint3：R（默认绕 y）  
  - Joint4：P（默认沿末端局部 x 平移）
- 机械臂模型可以简陋：用**棍子/圆柱**表示连杆即可（长度可调）。
- 每个关节的**旋转轴/平移轴必须画出来**（Arrow），并能在 UI 中修改轴向（预设 xyz + 自定义向量，自动归一化）。

### 3) 对偶四元数表示（必须统一）
- 位姿统一用 **qt 形式**：
  \[
  \hat x = q + \varepsilon q_t
  \]
  平移提取：
  \[
  t = 2 q_t q^*
  \]
- 旋转四元数用**轴角三角形式**展示：
  \[
  q(\theta,s)=\cos(\theta/2)+\sin(\theta/2)\,s
  \]
- UI 中所有“纯四元数”（例如旋转轴 \(s\)、平移方向 \(\hat t\)）都要用统一的“三角一致式”显示：
  \[
  s \equiv \cos(\pi/2)+\sin(\pi/2)\,s
  \]

### 4) 串联乘法链展示（UI 必须逐步展开）
- 串联正运动学：
  \[
  \hat x_N(q)=\hat x_1\hat x_2\hat x_3\hat x_4
  \]
- 乘法规则必须在 UI 可见、可逐步展示，并显示每项的**实部/对偶部**：
  \[
  (q_a+\varepsilon q_{t,a})(q_b+\varepsilon q_{t,b})
  =(q_a q_b)+\varepsilon(q_a q_{t,b}+q_{t,a}q_b)
  \]
- UI 要显示 \(x_1,x_2,x_3,x_4\) 以及中间项 \(x_{12},x_{123},x_N\) 的 \((q,q_t)\)。

### 5) 平移关节的特殊要求（qt 的核心）
- **平移关节只允许对偶部变化**，实部固定：
  - \(q_4 = 1\)
  - \(\hat x_4 = 1 + \varepsilon(\tau_4/2)\)，\(\tau_4 = d_4 \hat t_4\)

### 6) 误差建模（禁止加法误差）
- 误差不能用 “加 δθ、加 δL” 的方式。
- 必须按控制论文的方式用**乘性误差对偶四元数**注入（右乘）：
  \[
  \hat x_{\text{real}}(q)=\hat x_N(q)\,\hat c
  \]
- UI 必须允许用户编辑误差 \(\hat c = q_c + \varepsilon q_{t,c}\)（分量编辑 + 轴角参数化皆可），并显示误差量：
  \[
  \hat x_\Delta=\hat x_N^{-1}\hat x_{\text{real}}
  \]

### 7) 目标位姿 + 轨迹（必须同时展示两条）
- UI 可以输入目标位姿（两种方式都要支持）：
  1) 平移 \(p_d\) + 旋转轴角/四元数  
  2) 直接输入 qt 形式 \(\hat x_d=q_d+\varepsilon q_{t,d}\)
- 需要生成一段**期望轨迹** \( \hat x_d(t)\)（插值方式可选：Slerp/ScLERP）。
- 同时生成/显示一段**含误差的轨迹**（例如名义轨迹右乘 \(\hat c\) 后的轨迹），并在 3D 中画出来对比。

### 8) Jacobian 与几何意义（UI 要显示）
- UI 中要显示 \(J(q)\) 的结构与每一列的几何意义：关节轴如何通过前级位姿“共轭推进”到空间表达。
- 实现方式：优先解析构造，备选数值差分验证（最好有“验证按钮”）。

### 9) H∞ 部分（公式必须出现，仿真可选）
- UI 要显示控制论文中的关键公式块：
  - 名义运动学、含误差运动学
  - 跟踪误差定义（如 \(\tilde x,\tilde z\)）
  - H∞ 指标与参数 \(\gamma\) 的作用
  - \(\gamma\rightarrow \kappa_O,\kappa_T\) 的映射
  - Theorem 控制律结构（即使不闭环，也要能算出 \(\dot q\)）
- 可选：做闭环仿真，展示改变 \(\gamma\) 对收敛/控制量的影响。

### 10) 交付与开发方式
- 需要输出**代理模式任务提示词**（用于驱动后续开发/迭代）。
- 之前强调过“离线可运行”，但最后你说 **README 不一定离线**，因此可接受 CDN / 本地 server 两种运行方式。
